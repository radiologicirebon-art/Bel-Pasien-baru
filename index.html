<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🔔 Bel Pasien Baru</title>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1d899b, #0d3b66);
      color: #fff;
      text-align: center;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    button {
      background: #fff;
      color: #1d899b;
      border: none;
      border-radius: 10px;
      padding: 15px 30px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }
    button:hover {
      background: #e0f7fa;
      transform: scale(1.05);
    }
    .info {
      margin-top: 20px;
      font-size: 0.9rem;
      opacity: 0.9;
    }
  </style>
</head>
<body>

  <h1>🔔 Bel Pasien Baru</h1>
  <button id="btnPanggil">Panggil Pasien Baru</button>
  <p class="info">Klik sekali layar ini agar izin suara aktif 🔊</p>

  <!-- Suara bel -->
  <audio id="bellSound" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7c3b9c70b5.mp3?filename=notification-125125.mp3" type="audio/mpeg">
  </audio>

  <script>
    // ✅ Konfigurasi Firebase
    const firebaseConfig = {
      databaseURL: "https://bel-pasien-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const btn = document.getElementById("btnPanggil");
    const bell = document.getElementById("bellSound");

    let audioEnabled = false;

    // 🟢 Klik pertama -> aktifkan izin audio
    document.body.addEventListener("click", async () => {
      try {
        await bell.play();
        bell.pause();
        bell.currentTime = 0;
        audioEnabled = true;
        console.log("🔊 Audio diaktifkan");
      } catch (e) {
        console.warn("⚠️ Audio belum diizinkan");
      }
    }, { once: true });

    // 🚨 Tombol ditekan -> kirim sinyal ke Firebase
    btn.addEventListener("click", () => {
      db.ref("bel").set({
        status: "ON",
        waktu: Date.now()
      });
    });

    // 👂 Pantau Firebase -> mainkan suara jika status berubah
    db.ref("bel").on("value", (snap) => {
      const data = snap.val();
      if (data && data.status === "ON" && audioEnabled) {
        bell.currentTime = 0;
        bell.play().then(() => {
          console.log("🔔 Bel berbunyi!");
        }).catch((e) => {
          console.error("Gagal mainkan suara:", e);
        });
      }
    });
  </script>
</body>
</html>
